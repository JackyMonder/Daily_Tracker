services:
  flutter:
    build:
      context: .
      dockerfile: Dockerfile.dev
    container_name: daily_tracker_flutter_dev
    ports:
      - "8080:8080"
    volumes:
      - ./:/app
      - flutter_pub_cache:/root/.pub-cache
    environment:
      - CHOKIDAR_USEPOLLING=true
    command: ["bash", "-lc", "flutter pub get && flutter run -d web-server --web-port 8080 --web-hostname 0.0.0.0"]

  android_builder:
    build:
      context: .
      dockerfile: Dockerfile.android
    container_name: daily_tracker_android_builder
    volumes:
      - ./build_artifacts:/out
      - flutter_pub_cache:/root/.pub-cache
    environment:
      - TARGETS=android-arm,android-arm64
    command: ["bash", "-lc", "flutter doctor -v && ls -lah /out"]

volumes:
  flutter_pub_cache:
    driver: local

